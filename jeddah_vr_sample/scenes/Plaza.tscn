[gd_scene load_steps=8 format=3 uid="plaza-scene"]

[ext_resource path="res://scenes/TowerExterior.tscn" type="PackedScene" id=2]
[ext_resource path="res://scenes/DebugOverlay.tscn" type="PackedScene" id=1]
[ext_resource path="res://scripts/ui_manager.gd" type="Script" id=3]
[ext_resource path="res://scenes/TowerInterior.tscn" type="PackedScene" id=4]
[ext_resource path="res://scripts/player.gd" type="Script" id=5]

[node name="Plaza" type="Node3D"]
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0 )

[node name="TowerExteriorInstance" parent="." instance=ExtResource( 2 )]

[node name="Sun" parent="." type="DirectionalLight3D"]
light_energy = 2.0
shadow_enabled = true
transform = Transform3D( 0.707107, -0.707107, 0, 0.408248, 0.408248, -0.816497, 0.57735, 0.57735, 0.57735, 0, 50, 0 )

[node name="Reflection" parent="." type="ReflectionProbe3D"]
extents = Vector3( 300, 200, 300 )
update_mode = 1
priority = 1
origin_offset = Vector3( 0, 10, 0 )

# Surrounding buildings (simple blocky meshes to give city context)
[node name="Building1" parent="." type="MeshInstance3D"]
mesh = SubResource( 4 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 60, 0, -80 )

[node name="Building2" parent="." type="MeshInstance3D"]
mesh = SubResource( 5 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, -70, 0, -40 )

[node name="Building3" parent="." type="MeshInstance3D"]
mesh = SubResource( 6 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 40, 0, 90 )

[node name="Building4" parent="." type="MeshInstance3D"]
mesh = SubResource( 7 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, -120, 0, 70 )

# Tower placeholder (tall cylinder + tip)
[node name="TowerPlaceholder" parent="." type="MeshInstance3D"]
mesh = SubResource( 8 )
transform = Transform3D( 0.05, 0, 0, 0, 1.2, 0, 0, 0, 0.05, 0, 0, -20 )

[node name="TowerTip" parent="." type="MeshInstance3D"]
mesh = SubResource( 9 )
transform = Transform3D( 0.2, 0, 0, 0, 0.2, 0, 0, 0, 0.2, 0, 8.5, -20 )

# Red Sea Coast
[node name="Water" parent="." type="MeshInstance3D"]
mesh = SubResource( 10 )
material_override = SubResource( 11 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 200, -1, 0 )

[node name="Beach" parent="." type="MeshInstance3D"]
mesh = SubResource( 12 )
material_override = SubResource( 13 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 140, 0, 0 )

# Vegetation (palm trees and grass)
[node name="Vegetation" parent="." type="Node3D"]

[node name="PalmTree1" parent="Vegetation" type="MeshInstance3D"]
mesh = SubResource( 14 )
material_override = SubResource( 15 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 120, 1, 80 )

[node name="PalmTree2" parent="Vegetation" type="MeshInstance3D"]
mesh = SubResource( 14 )
material_override = SubResource( 15 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 160, 1, 100 )

[node name="PalmTree3" parent="Vegetation" type="MeshInstance3D"]
mesh = SubResource( 14 )
material_override = SubResource( 15 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 100, 1, 120 )

[node name="GrassPlane" parent="Vegetation" type="MeshInstance3D"]
mesh = SubResource( 16 )
material_override = SubResource( 17 )
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 60, 0.05, 40 )

[node name="PlayerStart" parent="." type="Marker3D"]
transform = Transform3D( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2, 0 )

[node name="Player" parent="." type="Node3D"]
script = ExtResource( 5 )
speed = 3.0

[node name="CanvasLayer" parent="." type="CanvasLayer"]
script = ExtResource( 3 )
interior_scene = ExtResource( 4 )

[node name="UIRoot" parent="CanvasLayer" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="Header" parent="UIRoot" type="Label"]
text = "برج جدة"
align = 1
valign = 1
rect_min_size = Vector2( 540, 84 )
rect_position = Vector2( 220, 60 )
custom_styles/font_color = Color( 1, 1, 1, 1 )
add_theme_color = true

[node name="MenuPanel" parent="UIRoot" type="PanelContainer"]
rect_min_size = Vector2( 640, 320 )
rect_position = Vector2( 160, 180 )

[node name="VBox" parent="MenuPanel" type="VBoxContainer"]
rect_min_size = Vector2( 600, 280 )
custom_constants/separation = 18

[node name="BtnExplore" parent="VBox" type="Button"]
text = "استكشاف الخارج"
rect_min_size = Vector2( 560, 80 )

[node name="BtnInterior" parent="VBox" type="Button"]
text = "مشاهدة داخل البرج"
rect_min_size = Vector2( 560, 80 )

[node name="BtnBack" parent="UIRoot" type="Button"]
text = "رجوع"
rect_min_size = Vector2( 140, 56 )
rect_position = Vector2( 20, 520 )

[node name="DebugOverlayInstance" parent="CanvasLayer" instance=ExtResource( 1 )]

[sub_resource type="Environment" id=3]
background_mode = 1 # Color
background_color = Color( 0.53, 0.73, 0.95 )
ambient_light_color = Color( 0.9, 0.92, 0.94 )
ambient_light_energy = 0.6
ssr_enabled = true
ssr_max_steps = 64
ssao_enabled = true
ssao_radius = 2.0
glow_enabled = true
glow_strength = 0.5

[sub_resource type="BoxMesh" id=4]
size = Vector3( 30, 80, 30 )

[sub_resource type="BoxMesh" id=5]
size = Vector3( 20, 60, 20 )

[sub_resource type="BoxMesh" id=6]
size = Vector3( 28, 100, 28 )

[sub_resource type="BoxMesh" id=7]
size = Vector3( 36, 50, 36 )

[sub_resource type="CylinderMesh" id=8]
top_radius = 6.0
bottom_radius = 6.0
height = 17.0
radial_segments = 32

[sub_resource type="ConeMesh" id=9]
bottom_radius = 2.0
height = 1.6
radial_segments = 24

[sub_resource type="PlaneMesh" id=10]
size = Vector2( 400, 300 )
subdivisions = Vector2i( 64, 64 )

[sub_resource type="StandardMaterial3D" id=11]
albedo_color = Color( 0.0, 0.5, 0.8, 0.7 )
metallic = 0.1
roughness = 0.2
transparency = TRANSPARENCY_ALPHA
emission_enabled = true
emission = Color( 0.1, 0.4, 0.6, 1 )
emission_energy = 0.3

[sub_resource type="PlaneMesh" id=12]
size = Vector2( 120, 300 )

[sub_resource type="StandardMaterial3D" id=13]
albedo_color = Color( 0.95, 0.9, 0.75, 1 )
metallic = 0.0
roughness = 0.8

# Palm tree trunk and foliage
[sub_resource type="CylinderMesh" id=14]
top_radius = 1.2
bottom_radius = 1.5
height = 8.0
radial_segments = 8

[sub_resource type="StandardMaterial3D" id=15]
albedo_color = Color( 0.4, 0.25, 0.1, 1 )
metallic = 0.0
roughness = 0.9

# Grass plane
[sub_resource type="PlaneMesh" id=16]
size = Vector2( 200, 200 )
subdivisions = Vector2i( 16, 16 )

[sub_resource type="StandardMaterial3D" id=17]
albedo_color = Color( 0.2, 0.5, 0.15, 1 )
metallic = 0.0
roughness = 0.95

